<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Maestro del C√≠rculo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body {
    background: radial-gradient(circle, #111, #000);
    color: white;
    text-align: center;
    font-family: Arial, sans-serif;
}
canvas {
    background: #111;
    border-radius: 50%;
    touch-action: none;
}
button, select {
    padding: 10px;
    margin: 5px;
    font-size: 16px;
}
#resultado {
    font-size: 22px;
    margin-top: 10px;
}
.maestro {
    color: #00ff66;
    animation: celebrar 1.2s infinite ease-in-out;
    text-shadow: 0 0 6px #00ff66, 0 0 12px #00ffaa;
}

@keyframes celebrar {
    0%   { transform: scale(1); }
    50%  { transform: scale(1.2); }
    100% { transform: scale(1); }
}

</style>
</head>

<body>
<br>
<h1>üåÄ Demuestra tu habilidad</h1>
<p>Dibuja una circunferencia lo mejor posible</p>
<select id="dificultad">
    <option value="120">F√°cil</option>
    <option value="90" selected>Medio</option>
    <option value="60">Dif√≠cil</option>
</select>

<br><br>
<canvas id="canvas" width="320" height="320"></canvas>

<br>
<button onclick="reiniciar()" class="btn btn-outline-danger">Reintentar</button>

<div id="resultado">Precisi√≥n: --%</div>
<div id="estrellas"></div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let dibujando = false;
let puntos = [];
let radioObjetivo = 90;
let centro = { x: 160, y: 160 };
let audioActual = null;
let particulas = [];
let timeScale = 1;


function explosionParticulas(x, y) {
    particulas = [];

    for (let i = 0; i < 80; i++) {
        const angulo = Math.random() * Math.PI * 2;
        const velocidad = Math.random() * 6 + 3;

        particulas.push({
            x,
            y,
            vx: Math.cos(angulo) * velocidad,
            vy: Math.sin(angulo) * velocidad,
            radio: Math.random() * 4 + 2,
            rotacion: Math.random() * Math.PI,
            rotVel: (Math.random() - 0.5) * 0.2,
            vida: 80,
            gravedad: 0.15,
            friccion: 0.98,
            color: `hsl(${Math.random() * 360}, 100%, 65%)`
        });
    }

    animarParticulas();
}

function animarParticulas() {
    if (particulas.length === 0) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    mostrarCirculoIdeal();

    for (let i = particulas.length - 1; i >= 0; i--) {
        const p = particulas[i];

        // Movimiento con slow-motion
        p.vy += p.gravedad * timeScale;
        p.vx *= p.friccion;
        p.vy *= p.friccion;

        p.x += p.vx * timeScale;
        p.y += p.vy * timeScale;
        p.rotacion += p.rotVel * timeScale;
        p.vida -= timeScale;

        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.vida / 80;

        dibujarEstrella(p.x, p.y, p.radio, p.rotacion);

        if (p.vida <= 0) {
            particulas.splice(i, 1);
        }
    }

    ctx.globalAlpha = 1;
    requestAnimationFrame(animarParticulas);
}

function dibujarEstrella(x, y, r, rot) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rot);
    ctx.beginPath();

    for (let i = 0; i < 5; i++) {
        ctx.lineTo(0, r);
        ctx.translate(0, r);
        ctx.rotate((Math.PI * 2) / 10);
        ctx.lineTo(0, -r);
        ctx.translate(0, -r);
        ctx.rotate(-(Math.PI * 6) / 10);
    }

    ctx.closePath();
    ctx.fill();
    ctx.restore();
}

function activarSlowMotion() {
    timeScale = 0.3;
    setTimeout(() => timeScale = 1, 900);
}

function vibrarMaestro() {
    if ("vibrate" in navigator) {
        navigator.vibrate([120, 60, 120, 60, 200]);
    }
}


function reproducirSonido(src, volumen = 0.5) {
    // Detener cualquier sonido anterior
    if (audioActual) {
        audioActual.pause();
        audioActual.currentTime = 0;
    }

    audioActual = new Audio(src);
    audioActual.volume = volumen;
    audioActual.play();
}

function sonido90() { // ‚â• 90%
    reproducirSonido("mix-wow-perfect-supermario.mp3", 0.5);
}

function sonido80() { // ‚â• 80%
    reproducirSonido("homero-ouch.mp3", 0.5);
}

function sonido60_70() { // ‚â• 60% y ‚â• 70%
    reproducirSonido("falled-sound.mp3", 0.5);
}

function sonidoMenor60() { // < 60%
    reproducirSonido("witch-laugh.mp3", 0.5);
}


function pos(e) {
    const r = canvas.getBoundingClientRect();
    if (e.touches) {
        return {
            x: e.touches[0].clientX - r.left,
            y: e.touches[0].clientY - r.top
        };
    }
    return {
        x: e.clientX - r.left,
        y: e.clientY - r.top
    };
}

function iniciar(e) {
    radioObjetivo = Number(dificultad.value);
    dibujando = true;
    puntos = [];
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
}

function dibujar(e) {
    if (!dibujando) return;
    e.preventDefault();

    let p = pos(e);
    puntos.push(p);

    let dist = Math.hypot(p.x - centro.x, p.y - centro.y);
    let error = Math.abs(dist - radioObjetivo);

    let color =
        error < 5 ? "#00ff88" :
        error < 12 ? "#ffee00" :
        "#ff4444";

    ctx.strokeStyle = color;
    ctx.lineWidth = 4;
    ctx.lineTo(p.x, p.y);
    ctx.stroke();
}

function finalizar() {
    if (!dibujando) return;
    dibujando = false;
    evaluar();
    mostrarCirculoIdeal();
}

function evaluar() {
    document.getElementById("resultado").className = "";

    let errores = puntos.map(p =>
        Math.abs(Math.hypot(p.x - centro.x, p.y - centro.y) - radioObjetivo)
    );

    let errorProm = errores.reduce((a,b)=>a+b) / errores.length;
    let precision = Math.max(0, 100 - errorProm * 2);

    let mensaje = "";
    let estrellas = 1;
    let clase = "";

   
    if (precision >= 90) {
        mensaje = "ü•á ¬°Ala hasta q por fin, jajaj ü´°\nYa eres un maestro/a! üòÅ ";
        estrellas = 5;
        clase = "maestro";
        sonido90();
        explosionParticulas(centro.x, centro.y);
        vibrarMaestro();
        activarSlowMotion();
    } else if (precision >= 80) {
        mensaje = "üî• ¬°Excelente control!\nYa casi ";
        estrellas = 4;
        sonido80();
    } else if (precision >= 70) {
        mensaje = "üëç ¬°Buen trabajo! ";
        estrellas = 3;
        sonido60_70();
    } else if (precision >= 60) {
        mensaje = "üôÇ Vas por buen camino";
        estrellas = 2;
        sonido60_70();
    } else {
        mensaje = " Ala q burr@ eres¬° Jajaj\n Sigue practicando! üòÅ";
        estrellas = 1;
        sonidoMenor60();
    }

    document.getElementById("resultado").className = clase;

    document.getElementById("resultado").innerText =
        `Precisi√≥n: ${precision.toFixed(1)}%\n${mensaje}`;

    document.getElementById("estrellas").innerText =
        "‚≠ê".repeat(estrellas);
}

function mostrarCirculoIdeal() {
    ctx.beginPath();
    ctx.strokeStyle = "rgba(0,150,255,0.6)";
    ctx.lineWidth = 2;
    ctx.setLineDash([6, 6]);
    ctx.arc(centro.x, centro.y, radioObjetivo, 0, Math.PI * 2);
    ctx.stroke();
    ctx.setLineDash([]);
}

function reiniciar() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particulas = [];
    const resultadoElem = document.getElementById("resultado");
    resultadoElem.innerText = "Precisi√≥n: --%";
    resultadoElem.className = ""; // üîπ quitar cualquier clase (como "maestro")
    document.getElementById("estrellas").innerText = "";
    puntos = [];

    // üîá Detener sonido activo
    if (audioActual) {
        audioActual.pause();
        audioActual.currentTime = 0;
        audioActual = null;
    }
    timeScale = 1;
}


canvas.addEventListener("mousedown", iniciar);
canvas.addEventListener("mousemove", dibujar);
canvas.addEventListener("mouseup", finalizar);

canvas.addEventListener("touchstart", iniciar);
canvas.addEventListener("touchmove", dibujar);
canvas.addEventListener("touchend", finalizar);
</script>

</body>
</html>
